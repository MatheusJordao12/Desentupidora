<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <link rel="stylesheet" href="css/CA.css".css">
  <title>‚ûï Cadastro de Atendimento</title>
</head>
<body>
    <nav>
        <a href="emi.html">Emiss√£o de Relat√≥rios</a>
        <a href="financeiro.html">Financeiro</a>
        <a href="segunda.html">Ordens</a>
        <a href="hist.html">Hist√≥rico de Atendimento</a>
        <a href="ci.html">Cadastro de Clientes</a>
        <a href="rc.html">Chamados</a>
        <a href="ag.html">Agenda</a>
    </nav>
        <h1>‚ûï Cadastro de Atendimento</h1>
    <main>
        <h2>Preencha os dados do atendimento</h2>
        <form id="formCadastro">
        <div>
            <label for="cliente">Nome do Cliente:</label>
            <input type="text" id="cliente" name="cliente" required>
            <label class="telefone" for="telefone">Telefone:</label>
            <input type="tel" id="telefone" name="telefone" placeholder="(99) 99999-9999" maxlength="15" required>
        </div>

        <label for="descricao">Descri√ß√£o do Atendimento:</label>
        <div class="campo">
            <textarea id="descricao" name="descricao" rows="4" required></textarea>
        </div>

        <div>
            <label for="status">Status:</label>
            <select id="status" name="status" required>
            <option value="">Selecione</option>
            <option value="Conclu√≠do">‚úÖ Conclu√≠do</option>
            <option value="Pendente">‚è≥ Pendente</option>
            <option value="Cancelado">‚ùå Cancelado</option>
            </select>
        </div>

        <button type="submit">Salvar Atendimento</button>
        </form>

        <h2>Hist√≥rico de Atendimentos</h2>
        <table>
        <thead>
            <tr>
            <th>Data</th>
            <th>Cliente</th>
            <th>Telefone</th>
            <th>Descri√ß√£o</th>
            <th>Status</th>
            </tr>
        </thead>
        <tbody id="listaAtendimentos">
            <tr class="no-data"><td colspan="5">Nenhum atendimento registrado</td></tr>
        </tbody>
        </table>
        <button class="btn-clear" onclick="limparHistorico()">üóëÔ∏è Limpar Hist√≥rico</button>

        <p class="msg" id="mensagem"></p>
    </main>

    <script>
        const input = document.getElementById("telefone")
        const form = document.getElementById("formCadastro");
        const msg = document.getElementById("mensagem");
        const lista = document.getElementById("listaAtendimentos");

        input.addEventListener("focus", () => {
        // S√≥ adiciona "(" se o campo estiver vazio
        if (input.value.length === 0) {
            input.value = "(";
            input.setSelectionRange(1, 1);
        }
        });

        input.addEventListener("input", () => {

            if (input.value.length === 3) {
                input.value = input.value + ") ";
                input.setSelectionRange(input.value.length, input.value.length);
            }

            if(input.value.length === 10){
                input.value = input.value + "-"

                input.setSelectionRange(input.value.length, input.value.length)
            }
        });

        function carregarAtendimentos() {
        const atendimentos = JSON.parse(localStorage.getItem("atendimentos")) || [];

        lista.innerHTML = "";

        if (atendimentos.length === 0) {
            lista.innerHTML = `<tr class="no-data"><td colspan="5">Nenhum atendimento registrado</td></tr>`;
            return;
        }

        atendimentos.forEach(at => {
            const tr = document.createElement("tr");
            tr.innerHTML = `
            <td>${at.data}</td>
            <td>${at.cliente}</td>
            <td>${at.telefone}</td>
            <td>${at.descricao}</td>
            <td>${at.status}</td>
            `;
            lista.appendChild(tr);
        });
        }

        form.addEventListener("submit", function(e) {
        e.preventDefault();

        const cliente = document.getElementById("cliente").value;
        const telefone = document.getElementById("telefone").value;
        const descricao = document.getElementById("descricao").value;
        const status = document.getElementById("status").value;
        const data = new Date().toLocaleString("pt-BR");

        const atendimento = { cliente, telefone, descricao, status, data };

        let atendimentos = JSON.parse(localStorage.getItem("atendimentos")) || [];
        atendimentos.push(atendimento);
        localStorage.setItem("atendimentos", JSON.stringify(atendimentos));

        msg.textContent = `‚úÖ Atendimento de ${cliente} cadastrado com sucesso!`;
        msg.style.color = "green";

        form.reset();
        carregarAtendimentos();
        });

        function limparHistorico() {
        if (confirm("Tem certeza que deseja apagar todo o hist√≥rico?")) {
            localStorage.removeItem("atendimentos");
            carregarAtendimentos();
        }
        }

        // Carrega os atendimentos ao abrir a p√°gina
        carregarAtendimentos();
    </script>
</body>
</html>
